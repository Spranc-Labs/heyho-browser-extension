# Raw Event Specification

This document outlines the structure of the `CoreEvent` object, which is the fundamental data unit captured by the browser extension. These raw events are persisted in IndexedDB and later processed by the aggregation system.

## `CoreEvent` Object Structure

The `CoreEvent` object is a JSON object with the following fields:

| Field               | Type     | Description                                                                                                                            |
| ------------------- | -------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| `id`                | `string` | A unique identifier for the event, generated by combining the event timestamp and the tab ID. Example: `evt_1678886400000_123`.          |
| `timestamp`         | `number` | The Unix timestamp (in milliseconds) when the event occurred.                                                                          |
| `type`              | `string` | The type of event that occurred. See [Event Types](#event-types) for a list of possible values.                                          |
| `tabId`             | `number` | The ID of the browser tab where the event occurred.                                                                                    |
| `url`               | `string` | The URL of the tab at the time of the event. This field may be empty for `CLOSE` and `HEARTBEAT` events.                                 |
| `domain`            | `string` | The domain of the URL, extracted using the `getDomain` helper function.                                                                |
| `anonymousClientId` | `string` | An anonymous, unique identifier for the client, generated by the `AnonymousIdModule`. This field is only present if the module is available. |

## See Also

*   [Data Relationships](./data-relationships.md)

## Event Types

The `type` field of the `CoreEvent` object can have one of the following values:

| Type        | Description                                                                                                                                  |
| ----------- | -------------------------------------------------------------------------------------------------------------------------------------------- |
| `CREATE`    | A new tab was created.                                                                                                                       |
| `ACTIVATE`  | The user switched focus to a different tab.                                                                                                  |
| `NAVIGATE`  | The user navigated to a new URL in a tab. This event is only triggered when the `changeInfo.url` property exists in the `onUpdated` listener. |
| `CLOSE`     | A tab was closed.                                                                                                                            |
| `HEARTBEAT` | A periodic event that is triggered to indicate that the user is still active. This event may contain additional metadata.                      |

### Heartbeat Metadata

For `HEARTBEAT` events, the `CoreEvent` object may contain additional fields in the `metadata` object. The specific fields in the `metadata` object are not strictly defined and can vary depending on the data being collected.
